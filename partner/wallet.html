<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Partner Wallet | QuickPress</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f6f6f6}
header{background:#FFD84D;padding:15px;font-weight:700}
.card{background:#fff;margin:15px;border-radius:12px;padding:16px}
.balance{font-size:28px;font-weight:700}
button{
  background:#FFD84D;border:none;padding:10px 14px;
  border-radius:8px;font-weight:700;cursor:pointer
}
table{width:100%;border-collapse:collapse;margin-top:10px}
td,th{padding:8px;border-bottom:1px solid #eee;font-size:14px}
</style>
</head>

<body>

<header>ðŸ’° Partner Wallet</header>

<div class="card">
  <div>Available Balance</div>
  <div class="balance">â‚¹<span id="balance">0</span></div>
  <br>
  <button onclick="requestPayout()">Request Payout</button>
</div>

<div class="card">
  <h3>Payout History</h3>
  <table>
    <thead>
      <tr><th>Amount</th><th>Status</th></tr>
    </thead>
    <tbody id="payouts"></tbody>
  </table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore,doc,getDoc,collection,addDoc,getDocs,query,where } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const app=initializeApp({
  apiKey:"AIzaSyCqrOXjuQIgfSKS7_YBb_ft-Z6ubsGpAqs",
  authDomain:"quickpress-e486d.firebaseapp.com",
  projectId:"quickpress-e486d"
});
const auth=getAuth(app);
const db=getFirestore(app);

let currentUser;

onAuthStateChanged(auth,async user=>{
  if(!user){location.href="../login.html";return;}
  currentUser=user;
  loadWallet();
  loadPayouts();
});

async function loadWallet(){
  const snap=await getDoc(doc(db,"wallets",currentUser.uid));
  if(snap.exists()) document.getElementById("balance").innerText=snap.data().balance||0;
}

async function requestPayout(){
  const amount=prompt("Enter payout amount");
  if(!amount) return;

  await addDoc(collection(db,"payouts"),{
    userId:currentUser.uid,
    role:"partner",
    amount:Number(amount),
    status:"pending",
    createdAt:Date.now()
  });
  alert("Payout requested");
  loadPayouts();
}

async function loadPayouts(){
  const q=query(collection(db,"payouts"),where("userId","==",currentUser.uid));
  const snap=await getDocs(q);
  const body=document.getElementById("payouts");
  body.innerHTML="";
  snap.forEach(s=>{
    const d=s.data();
    body.innerHTML+=`<tr><td>â‚¹${d.amount}</td><td>${d.status}</td></tr>`;
  });
}
</script>
<!-- ===== QUICKPRESS GLOBAL UI ===== -->
<link rel="stylesheet" href="../assets/ui.css">
<script src="../assets/ui.js"></script>
<!-- =============================== -->

</body>
</html>
