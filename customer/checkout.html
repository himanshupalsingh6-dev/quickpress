<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Checkout</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../assets/ui.css">
</head>

<body>
<div class="container">
  <h2>ðŸ§¾ Checkout</h2>

  <p><b>City:</b> <span id="city"></span></p>
  <p><b>Total:</b> â‚¹<span id="total">0</span></p>

  <button onclick="placeOrder()">Place Order</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";
import { getTotal } from "../assets/cart.js";
import { createOrderWithAutoMapping } from "../assets/order-mapping.js";

const app = initializeApp({
  apiKey:"AIzaSyCqrOXjuQIgfSKS7_YBb_ft-Z6ubsGpAqs",
  authDomain:"quickpress-e486d.firebaseapp.com",
  projectId:"quickpress-e486d"
});

const auth = getAuth(app);
const db = getFirestore(app);

const city = localStorage.getItem("selectedCity");
document.getElementById("city").innerText = city || "Not selected";

const total = getTotal();
document.getElementById("total").innerText = total;

window.placeOrder = async ()=>{
  if(!city){
    alert("Select city first");
    return;
  }
  if(total <= 0){
    alert("Cart empty");
    return;
  }

  await createOrderWithAutoMapping({
    cityId: city,
    totalAmount: total
  });

  alert("âœ… Order placed");
};
</script>
</body>
</html>
